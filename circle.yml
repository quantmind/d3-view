machine:

  node:
    version: 8.9.1


dependencies:
  override:
    - sudo apt-get update && sudo apt-get install libpango1.0-0 && sudo apt-get install firefox
    - sudo ln -sf /usr/lib/firefox/firefox /usr/bin/firefox
    - npm install


test:
  override:
    - yarn test
    - yarn cover
  post:
    - bash <(curl -s https://codecov.io/bash)


deployment:
  publish:
    branch: master
    commands:
      - git config --global user.email "bot@quantmind.com"
      - git config --global user.username "qmbot"
      - git config --global user.name "Quantmind Bot"
      - cd && git clone git@github.com:quantmind/giottojs.org.git
      - cd && echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" > .npmrc
      - npm run-script release
